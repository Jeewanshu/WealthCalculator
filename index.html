<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Indian Rupee Compound Interest Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #4cc9f0;
            --success-color: #2ecc71;
            --warning-color: #f9c74f;
            --danger-color: #e63946;
            --current-color: #7209b7;
            --account-color: #ff6b6b;
            --export-color: #ff9e00;
            --upload-color: #00b4d8;
            --person-color: #9b59b6;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --gray-color: #6c757d;
            --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-color);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            border-left: 5px solid var(--primary-color);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--primary-color);
        }

        h1 {
            font-size: 2.5rem;
            color: var(--secondary-color);
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--gray-color);
            max-width: 800px;
            margin: 0 auto;
        }

        /* Calculator Wrapper */
        .calculator-wrapper {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 1024px) {
            .calculator-wrapper {
                grid-template-columns: 1fr;
            }
        }

        /* Form Section */
        .form-section, .result-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
        }

        .form-section h2, .result-section h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
            color: var(--secondary-color);
            font-size: 1.8rem;
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 15px;
        }

        .form-section h2 i, .result-section h2 i {
            color: var(--primary-color);
        }

        /* Mode Selector */
        .mode-selector {
            margin-bottom: 30px;
        }

        .mode-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .mode-btn {
            padding: 12px 10px;
            background: #f1f3f9;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            text-align: center;
            font-size: 0.85rem;
        }

        .mode-btn i {
            font-size: 1.2rem;
        }

        .mode-btn:hover {
            background: #e4e7f1;
        }

        .mode-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .mode-btn.current.active {
            background: var(--current-color);
            border-color: var(--current-color);
        }

        .mode-description {
            font-size: 0.9rem;
            color: var(--gray-color);
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 3px solid var(--primary-color);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        label i {
            color: var(--primary-color);
        }

        input, select {
            width: 100%;
            padding: 14px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
            background-color: #f9f9f9;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            background-color: white;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .date-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .input-row, .date-row {
                grid-template-columns: 1fr;
            }
            .mode-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Range Slider */
        .range-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .range-container input[type="range"] {
            flex: 1;
            padding: 0;
            height: 8px;
            border-radius: 4px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }

        .range-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .range-container span {
            font-weight: 600;
            color: var(--primary-color);
            min-width: 40px;
        }

        .input-hint {
            font-size: 0.85rem;
            color: var(--gray-color);
            margin-top: 5px;
            margin-left: 5px;
        }

        /* Enhanced Account Information Section */
        .account-info-section {
            margin: 25px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9ff, #eef1ff);
            border-radius: 15px;
            border-left: 5px solid var(--person-color);
        }

        .account-info-section h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--person-color);
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .person-field {
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(155, 89, 182, 0.1);
            border-radius: 12px;
            border: 2px dashed var(--person-color);
        }

        .person-field label {
            color: var(--person-color);
            font-weight: 600;
        }

        .person-field input {
            border-color: var(--person-color);
        }

        .account-fields {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {
            .account-fields {
                grid-template-columns: 1fr;
            }
        }

        .account-field-group {
            background: rgba(255, 107, 107, 0.05);
            padding: 15px;
            border-radius: 12px;
            border: 2px dashed var(--account-color);
        }

        .account-field-group label {
            color: var(--account-color);
        }

        .account-field-group input,
        .account-field-group select {
            border-color: var(--account-color);
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: var(--transition);
            flex: 1;
        }

        .calculate-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(67, 97, 238, 0.3);
        }

        .save-btn {
            background: linear-gradient(135deg, var(--success-color), #27ae60);
            color: white;
        }

        .save-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(46, 204, 113, 0.3);
        }

        .export-btn {
            background: linear-gradient(135deg, var(--export-color), #ff7b00);
            color: white;
        }

        .export-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(255, 158, 0, 0.3);
        }

        .reset-btn {
            background: #f1f3f9;
            color: var(--dark-color);
        }

        .reset-btn:hover {
            background: #e4e7f1;
        }

        .copy-btn {
            background: linear-gradient(135deg, var(--accent-color), #0096c7);
            color: white;
        }

        .copy-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(76, 201, 240, 0.3);
        }

        /* Results Section */
        .results-container {
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }

        .placeholder-message {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: var(--gray-color);
            padding: 40px 20px;
        }

        .placeholder-message i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #e0e0e0;
        }

        .placeholder-message p {
            font-size: 1.1rem;
            max-width: 300px;
        }

        .results-content {
            display: none;
        }

        /* Result Cards */
        .result-card {
            background: linear-gradient(135deg, #f8f9ff, #eef1ff);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid var(--primary-color);
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
        }

        .result-card.main-result {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .result-card.current-result {
            background: linear-gradient(135deg, var(--current-color), #560bad);
            border-left: 5px solid var(--current-color);
            color: white;
        }

        .result-card.person-card {
            background: linear-gradient(135deg, #f3e8ff, #e8d5ff);
            border-left: 5px solid var(--person-color);
        }

        .result-card.account-card {
            background: linear-gradient(135deg, #fff5f5, #ffeaea);
            border-left: 5px solid var(--account-color);
        }

        .result-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .result-details h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
            font-weight: 500;
            opacity: 0.9;
        }

        .amount {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1;
        }

        .rupee-symbol {
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        @media (max-width: 768px) {
            .result-grid {
                grid-template-columns: 1fr;
            }
        }

        .result-item {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 12px;
            border-left: 3px solid var(--accent-color);
        }

        .result-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--gray-color);
            margin-bottom: 5px;
        }

        .result-label i {
            color: var(--accent-color);
        }

        .result-value {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        /* Person & Account Info Display */
        .person-info, .account-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .person-field-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(155, 89, 182, 0.1);
            border-radius: 10px;
            border-left: 3px solid var(--person-color);
        }

        .person-label {
            font-weight: 500;
            color: var(--person-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .person-value {
            font-weight: 600;
            color: var(--dark-color);
        }

        .account-field {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(255, 107, 107, 0.1);
            border-radius: 10px;
            border-left: 3px solid var(--account-color);
        }

        .account-label {
            font-weight: 500;
            color: var(--account-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .account-value {
            font-weight: 600;
            color: var(--dark-color);
        }

        /* Progress Bar */
        .progress-section {
            margin: 25px 0;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .progress-label {
            font-weight: 500;
            color: var(--dark-color);
        }

        .progress-percentage {
            font-weight: 600;
            color: var(--primary-color);
        }

        .progress-bar {
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 5px;
            width: 0%;
            transition: width 1s ease;
        }

        /* Person Summary Cards */
        .person-summary-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 40px;
            border-left: 5px solid var(--person-color);
        }

        .person-summary-section h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
            color: var(--person-color);
            font-size: 1.8rem;
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 15px;
        }

        .person-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .person-card {
            background: linear-gradient(135deg, #f3e8ff, #e8d5ff);
            border-radius: 15px;
            padding: 20px;
            border-left: 4px solid var(--person-color);
            transition: var(--transition);
        }

        .person-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(155, 89, 182, 0.2);
        }

        .person-card h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--person-color);
            margin-bottom: 15px;
            font-size: 1.2rem;
            padding-bottom: 10px;
            border-bottom: 2px dashed var(--person-color);
        }

        .person-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .person-stats .label {
            color: #666;
        }

        .person-stats .value {
            font-weight: 600;
            color: var(--person-color);
        }

        .person-total {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--person-color);
            text-align: right;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 2px dashed var(--person-color);
        }

        /* Person Filter */
        .person-filter {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .filter-title {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--person-color);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid var(--person-color);
            background: white;
            color: var(--person-color);
            border-radius: 30px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .filter-btn:hover {
            background: rgba(155, 89, 182, 0.1);
        }

        .filter-btn.active {
            background: var(--person-color);
            color: white;
        }

        /* Enhanced Savings Section */
        .savings-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 40px;
        }

        .savings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .savings-header h2 {
            color: var(--secondary-color);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .savings-header h2 i {
            color: var(--success-color);
        }

        .total-savings {
            background: linear-gradient(135deg, var(--success-color), #27ae60);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .quick-copy-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .quick-copy-buttons .btn {
            padding: 10px 20px;
            font-size: 0.95rem;
        }

        /* Enhanced Savings Item */
        .savings-list {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .savings-list::-webkit-scrollbar {
            width: 8px;
        }

        .savings-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .savings-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }

        .savings-item {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid var(--success-color);
            transition: var(--transition);
            position: relative;
        }

        .savings-item:hover {
            background: #f0f0f0;
            transform: translateX(5px);
        }

        .savings-header-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px dashed #ddd;
        }

        .savings-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 1rem;
            color: var(--dark-color);
        }

        .savings-title i {
            color: var(--success-color);
        }

        .person-badge {
            background: var(--person-color);
            color: white;
            padding: 5px 15px;
            border-radius: 30px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Enhanced Details Grid - Shows all required fields */
        .details-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .details-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .detail-box {
            background: white;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .detail-box .label {
            font-size: 0.75rem;
            color: var(--gray-color);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-box .value {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .principal-value {
            color: var(--primary-color);
        }

        .rate-value {
            color: var(--accent-color);
        }

        .maturity-value {
            color: var(--export-color);
        }

        .current-value {
            color: var(--current-color);
        }

        .account-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }

        .account-badge {
            background: rgba(255, 107, 107, 0.1);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--account-color);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .savings-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #ddd;
            font-size: 0.85rem;
            color: var(--gray-color);
        }

        .savings-footer i {
            margin-right: 5px;
        }

        .copy-btn-small {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            padding: 5px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .copy-btn-small:hover {
            transform: scale(1.1);
        }

        .no-savings {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-color);
        }

        .no-savings i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #e0e0e0;
        }

        /* Export Modal */
        .export-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .export-modal.show {
            display: flex;
        }

        .export-content {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        }

        .export-header {
            background: linear-gradient(135deg, var(--export-color), #ff7b00);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .export-header h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .export-body {
            padding: 20px;
            max-height: calc(80vh - 80px);
            overflow-y: auto;
        }

        .export-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .export-option {
            text-align: center;
            padding: 20px;
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .export-option:hover {
            border-color: var(--export-color);
            background: rgba(255, 158, 0, 0.05);
        }

        .export-option i {
            font-size: 2rem;
            color: var(--export-color);
            margin-bottom: 10px;
        }

        .export-preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .export-preview pre {
            background: white;
            padding: 10px;
            border-radius: 5px;
            max-height: 150px;
            overflow: auto;
            font-size: 0.85rem;
        }

        .snapshot-list {
            max-height: 150px;
            overflow-y: auto;
        }

        /* Notification */
        .custom-notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 25px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            z-index: 1002;
            transform: translateX(100px);
            opacity: 0;
            transition: all 0.3s;
            max-width: 400px;
            font-weight: 500;
        }

        .custom-notification.success {
            background: var(--success-color);
            color: white;
        }

        .custom-notification.error {
            background: var(--danger-color);
            color: white;
        }

        .custom-notification.warning {
            background: var(--warning-color);
            color: var(--dark-color);
        }

        .custom-notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        /* Upload Section */
        .upload-section {
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #e0f2fe, #bae6fd);
            border-radius: 15px;
            border-left: 5px solid var(--upload-color);
        }

        .upload-section h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--upload-color);
        }

        .upload-area {
            border: 3px dashed var(--upload-color);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: rgba(0, 180, 216, 0.05);
        }

        .upload-area:hover {
            background: rgba(0, 180, 216, 0.1);
            transform: scale(1.02);
        }

        .upload-area i {
            font-size: 3rem;
            color: var(--upload-color);
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .uploaded-file-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: white;
            border-radius: 12px;
            padding: 15px 20px;
            margin-top: 15px;
            border: 2px solid var(--upload-color);
        }

        .file-details {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .file-details i {
            font-size: 2rem;
            color: var(--upload-color);
        }

        .file-name {
            font-weight: 600;
        }

        .file-meta {
            font-size: 0.85rem;
            color: var(--gray-color);
        }

        .remove-file {
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* Comparison Section */
        .comparison-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
            margin-bottom: 40px;
            border-left: 5px solid var(--upload-color);
        }

        .comparison-section h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
            color: var(--upload-color);
            font-size: 1.8rem;
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 15px;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .summary-card {
            background: linear-gradient(135deg, #f8f9ff, #eef1ff);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border-left: 4px solid var(--primary-color);
        }

        .summary-card h4 {
            font-size: 0.9rem;
            color: var(--gray-color);
            margin-bottom: 10px;
        }

        .summary-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .comparison-accounts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .growth-indicator {
            background: linear-gradient(135deg, var(--success-color), #27ae60);
            color: white;
            border-radius: 50px;
            padding: 15px 25px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 20px 0;
        }

        .growth-indicator.negative {
            background: linear-gradient(135deg, var(--danger-color), #c1121f);
        }

        /* Info Section */
        .info-section {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .info-section {
                grid-template-columns: 1fr;
            }
        }

        .info-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            text-align: center;
            transition: var(--transition);
        }

        .info-card:hover {
            transform: translateY(-5px);
        }

        .info-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .info-card h3 {
            margin-bottom: 10px;
            color: var(--secondary-color);
        }

        .info-card p {
            color: var(--gray-color);
            line-height: 1.5;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 25px;
            background: white;
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            color: var(--gray-color);
        }

        .tech-stack {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .tech-item {
            background: #f1f3f9;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--primary-color);
        }

        /* Error Message */
        .error-message {
            background: #ffeaea;
            color: var(--danger-color);
            padding: 15px 20px;
            border-radius: 12px;
            border-left: 4px solid var(--danger-color);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            display: none;
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        .hidden {
            display: none;
        }

        .calculation-summary {
            background: #f0f7ff;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--accent-color);
        }

        .summary-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-text {
            line-height: 1.6;
            color: var(--dark-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-calculator"></i>
                <h1>Advanced Compound Interest Calculator</h1>
            </div>
            <p class="subtitle">Track investments by person • Principal • Interest Rate • Maturity Amount • Current Value</p>
        </header>

        <div class="calculator-wrapper">
            <!-- Input Form Section -->
            <div class="form-section">
                <h2><i class="fas fa-edit"></i> Investment Details</h2>
                
                <!-- Mode Selector -->
                <div class="mode-selector">
                    <div class="mode-buttons">
                        <button class="mode-btn active" data-mode="amount">
                            <i class="fas fa-money-check-alt"></i> Find Maturity
                        </button>
                        <button class="mode-btn" data-mode="interest">
                            <i class="fas fa-percentage"></i> Find Interest Rate
                        </button>
                        <button class="mode-btn" data-mode="principal">
                            <i class="fas fa-money-bill-wave"></i> Find Principal
                        </button>
                        <button class="mode-btn current" data-mode="current">
                            <i class="fas fa-chart-line"></i> Find Current Value
                        </button>
                    </div>
                    <div class="mode-description" id="modeDescription">
                        Calculate the final maturity amount based on principal, interest rate, and time period.
                    </div>
                </div>

                <form id="interestForm">
                    <!-- Mode 1: Find Maturity Amount -->
                    <div class="mode-content" id="modeAmount">
                        <div class="form-group">
                            <label for="principal_amount">
                                <i class="fas fa-money-bill-wave"></i> Principal Amount (₹)
                            </label>
                            <input type="number" id="principal_amount" name="principal_amount" 
                                   placeholder="Enter initial investment amount" 
                                   value="10000" step="0.01" min="0">
                            <div class="input-hint">Minimum: ₹1</div>
                        </div>

                        <div class="form-group">
                            <label for="interest_rate">
                                <i class="fas fa-percentage"></i> Annual Interest Rate (%)
                            </label>
                            <div class="range-container">
                                <input type="range" id="rateSlider" min="0" max="20" step="0.1" value="7.5">
                                <span id="rateValue">7.5%</span>
                            </div>
                            <input type="number" id="interest_rate" name="interest_rate" 
                                   placeholder="Enter annual interest rate percentage" 
                                   value="7.5" step="0.01" min="0" max="100">
                        </div>
                    </div>

                    <!-- Mode 2: Find Interest Rate -->
                    <div class="mode-content hidden" id="modeInterest">
                        <div class="form-group">
                            <label for="principal_interest">
                                <i class="fas fa-money-bill-wave"></i> Principal Amount (₹)
                            </label>
                            <input type="number" id="principal_interest" name="principal_interest" 
                                   placeholder="Enter initial investment amount" 
                                   value="10000" step="0.01" min="0">
                        </div>

                        <div class="form-group">
                            <label for="maturity_amount_interest">
                                <i class="fas fa-bullseye"></i> Target Maturity Amount (₹)
                            </label>
                            <input type="number" id="maturity_amount_interest" name="maturity_amount_interest" 
                                   placeholder="Enter target maturity amount" 
                                   value="15000" step="0.01" min="0">
                            <div class="input-hint">The amount you want to achieve at maturity</div>
                        </div>
                    </div>

                    <!-- Mode 3: Find Principal Amount -->
                    <div class="mode-content hidden" id="modePrincipal">
                        <div class="form-group">
                            <label for="maturity_amount_principal">
                                <i class="fas fa-bullseye"></i> Target Maturity Amount (₹)
                            </label>
                            <input type="number" id="maturity_amount_principal" name="maturity_amount_principal" 
                                   placeholder="Enter target maturity amount" 
                                   value="15000" step="0.01" min="0">
                        </div>

                        <div class="form-group">
                            <label for="interest_rate_principal">
                                <i class="fas fa-percentage"></i> Annual Interest Rate (%)
                            </label>
                            <div class="range-container">
                                <input type="range" id="rateSliderPrincipal" min="0" max="20" step="0.1" value="7.5">
                                <span id="rateValuePrincipal">7.5%</span>
                            </div>
                            <input type="number" id="interest_rate_principal" name="interest_rate_principal" 
                                   placeholder="Enter annual interest rate percentage" 
                                   value="7.5" step="0.01" min="0" max="100">
                        </div>
                    </div>

                    <!-- Mode 4: Find Current Value -->
                    <div class="mode-content hidden" id="modeCurrent">
                        <div class="form-group">
                            <label for="principal_current">
                                <i class="fas fa-money-bill-wave"></i> Principal Amount (₹)
                            </label>
                            <input type="number" id="principal_current" name="principal_current" 
                                   placeholder="Enter initial investment amount" 
                                   value="10000" step="0.01" min="0">
                        </div>

                        <div class="form-group">
                            <label for="maturity_amount_current">
                                <i class="fas fa-bullseye"></i> Maturity Amount (₹)
                            </label>
                            <input type="number" id="maturity_amount_current" name="maturity_amount_current" 
                                   placeholder="Enter final maturity amount" 
                                   value="15000" step="0.01" min="0">
                            <div class="input-hint">The total amount at maturity date</div>
                        </div>
                    </div>

                    <!-- Common Fields for All Modes -->
                    <div class="date-row">
                        <div class="form-group">
                            <label for="start_date">
                                <i class="fas fa-play-circle"></i> Start Date
                            </label>
                            <input type="date" id="start_date" name="start_date" required>
                        </div>

                        <div class="form-group">
                            <label for="maturity_date">
                                <i class="fas fa-calendar-check"></i> Maturity Date
                            </label>
                            <input type="date" id="maturity_date" name="maturity_date" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="compound_frequency">
                            <i class="fas fa-clock"></i> Compounding Frequency
                        </label>
                        <select id="compound_frequency" name="compound_frequency">
                            <option value="365">Daily</option>
                            <option value="52">Weekly</option>
                            <option value="12" selected>Monthly</option>
                            <option value="4">Quarterly</option>
                            <option value="2">Semi-annually</option>
                            <option value="1">Annually</option>
                        </select>
                    </div>

                    <!-- ENHANCED: Account Information Section with Person Name -->
                    <div class="account-info-section">
                        <h3>
                            <i class="fas fa-user-circle"></i>
                            Account Information (Optional)
                        </h3>
                        
                        <!-- Person Name Field - NEW -->
                        <div class="person-field">
                            <label for="person_name">
                                <i class="fas fa-user-tie"></i> Account Holder Name
                            </label>
                            <input type="text" id="person_name" name="person_name" 
                                   placeholder="e.g., John Doe, Family, Business Name">
                            <div class="input-hint">Enter name to track investments by person</div>
                        </div>

                        <!-- Account Fields -->
                        <div class="account-fields">
                            <div class="account-field-group">
                                <label for="account_number">
                                    <i class="fas fa-credit-card"></i> Account Number
                                </label>
                                <input type="text" id="account_number" name="account_number" 
                                       placeholder="Enter account number">
                                <div class="input-hint">Optional</div>
                            </div>

                            <div class="account-field-group">
                                <label for="account_type">
                                    <i class="fas fa-landmark"></i> Account Type
                                </label>
                                <select id="account_type" name="account_type">
                                    <option value="">Select Account Type</option>
                                    <option value="savings">Savings Account</option>
                                    <option value="current">Current Account</option>
                                    <option value="fixed_deposit">Fixed Deposit</option>
                                    <option value="recurring_deposit">Recurring Deposit</option>
                                    <option value="ppf">Public Provident Fund (PPF)</option>
                                    <option value="nps">National Pension System (NPS)</option>
                                    <option value="mutual_fund">Mutual Fund</option>
                                    <option value="stocks">Stocks/Equity</option>
                                    <option value="bonds">Bonds</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>

                            <div class="account-field-group" style="grid-column: span 2;">
                                <label for="bank_name">
                                    <i class="fas fa-building"></i> Bank/Institution Name
                                </label>
                                <input type="text" id="bank_name" name="bank_name" 
                                       placeholder="Enter bank or institution name">
                            </div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="button" class="btn calculate-btn" id="calculateBtn">
                            <i class="fas fa-calculator"></i> Calculate Now
                        </button>
                        <button type="button" class="btn reset-btn" id="resetBtn">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                </form>
            </div>

            <!-- Results Section -->
            <div class="result-section">
                <h2><i class="fas fa-chart-bar"></i> Calculation Results 
                    <span class="mode-indicator" id="modeIndicator">
                        <i class="fas fa-money-check-alt"></i> Maturity Amount Mode
                    </span>
                </h2>
                <div class="results-container">
                    <div class="placeholder-message" id="placeholderMessage">
                        <i class="fas fa-arrow-left"></i>
                        <p>Fill the form and click "Calculate Now" to see results</p>
                    </div>
                    
                    <div class="results-content" id="resultsContent">
                        <div class="result-card main-result" id="mainResultCard">
                            <div class="result-icon">
                                <i class="fas fa-money-check-alt" id="resultIcon"></i>
                            </div>
                            <div class="result-details">
                                <h3 id="resultTitle">Final Maturity Amount</h3>
                                <div class="amount" id="finalAmount">
                                    <span class="rupee-symbol">₹</span>0.00
                                </div>
                            </div>
                        </div>
                        
                        <!-- Current Value Card -->
                        <div class="result-card current-result" id="currentValueCard" style="display: none;">
                            <div class="result-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="result-details">
                                <h3>Current Value (Today)</h3>
                                <div class="amount" id="currentAmount">
                                    <span class="rupee-symbol">₹</span>0.00
                                </div>
                            </div>
                        </div>

                        <!-- Person Info Card - Shows when person name entered -->
                        <div class="result-card person-card" id="personCard" style="display: none;">
                            <div class="result-icon">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="result-details">
                                <h3>Account Holder</h3>
                                <div class="amount" id="personNameDisplay">-</div>
                            </div>
                        </div>

                        <!-- Account Info Card -->
                        <div class="result-card account-card" id="accountCard" style="display: none;">
                            <div class="result-icon">
                                <i class="fas fa-university"></i>
                            </div>
                            <div class="result-details">
                                <h3>Account Details</h3>
                                <div class="account-info" id="accountInfoDisplay">
                                    <!-- Will be populated -->
                                </div>
                            </div>
                        </div>

                        <!-- Progress Bar -->
                        <div class="progress-section" id="progressSection" style="display: none;">
                            <div class="progress-info">
                                <span class="progress-label">Investment Progress</span>
                                <span class="progress-percentage" id="progressPercentage">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                        </div>
                        
                        <div class="result-grid">
                            <div class="result-item">
                                <div class="result-label">
                                    <i class="fas fa-money-bill-wave"></i> Principal
                                </div>
                                <div class="result-value" id="principalResult">
                                    <span class="rupee-symbol">₹</span>0.00
                                </div>
                            </div>
                            
                            <div class="result-item">
                                <div class="result-label">
                                    <i class="fas fa-coins"></i> Interest Earned
                                </div>
                                <div class="result-value" id="interestEarned">
                                    <span class="rupee-symbol">₹</span>0.00
                                </div>
                            </div>
                            
                            <div class="result-item">
                                <div class="result-label">
                                    <i class="fas fa-percentage"></i> Interest Rate
                                </div>
                                <div class="result-value" id="interestRateResult">0%</div>
                            </div>
                            
                            <div class="result-item">
                                <div class="result-label">
                                    <i class="fas fa-calendar-alt"></i> Investment Period
                                </div>
                                <div class="result-value" id="investmentPeriod">0 years</div>
                            </div>
                            
                            <div class="result-item">
                                <div class="result-label">
                                    <i class="fas fa-clock"></i> Compounding
                                </div>
                                <div class="result-value" id="compoundingResult">Monthly</div>
                            </div>
                            
                            <div class="result-item">
                                <div class="result-label">
                                    <i class="fas fa-calendar"></i> Dates
                                </div>
                                <div class="result-value" id="datesRange">-</div>
                            </div>
                        </div>
                        
                        <div class="calculation-summary">
                            <div class="summary-title">
                                <i class="fas fa-info-circle"></i> Calculation Summary
                            </div>
                            <div class="summary-text" id="calculationSummary">
                                Your investment details will be summarized here.
                            </div>
                        </div>
                        
                        <div class="button-group">
                            <button type="button" class="btn save-btn" id="saveAmountBtn">
                                <i class="fas fa-plus-circle"></i> Add to Savings
                            </button>
                        </div>
                    </div>
                    
                    <div class="error-message" id="errorMessage">
                        <i class="fas fa-exclamation-circle"></i>
                        <p id="errorText">An error occurred during calculation</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Person Summary Section -->
        <div class="person-summary-section" id="personSummarySection">
            <h2><i class="fas fa-users"></i> Person-wise Summary</h2>
            <div class="person-summary-grid" id="personSummaryGrid">
                <div class="no-savings" style="text-align: center; padding: 40px;">
                    <i class="fas fa-user-plus" style="font-size: 3rem; color: #ccc; margin-bottom: 15px;"></i>
                    <p>Add account holder names to see person-wise summary</p>
                </div>
            </div>
        </div>

        <!-- Upload Section -->
        <div class="upload-section">
            <h3><i class="fas fa-cloud-upload-alt"></i> Upload Snapshot for Comparison</h3>
            <div class="upload-area" id="uploadArea">
                <i class="fas fa-file-upload"></i>
                <p>Drag & drop or click to upload</p>
                <small>JSON or text files with multiple accounts</small>
                <input type="file" id="fileInput" class="file-input" accept=".json,.txt,application/json,text/plain">
            </div>
            <div id="uploadedFileInfo" style="display: none;" class="uploaded-file-info">
                <div class="file-details">
                    <i class="fas fa-file-alt"></i>
                    <div>
                        <div class="file-name" id="uploadedFileName"></div>
                        <div class="file-meta" id="uploadedFileMeta"></div>
                    </div>
                </div>
                <button class="remove-file" id="removeFileBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="button-group" style="margin-top: 20px;">
                <button type="button" class="btn recalculate-btn" id="recalculateFromUploadBtn" disabled>
                    <i class="fas fa-sync-alt"></i> Compare Accounts
                </button>
            </div>
        </div>

        <!-- Comparison Section -->
        <div class="comparison-section" id="comparisonSection" style="display: none;">
            <h2><i class="fas fa-chart-line"></i> Portfolio Comparison</h2>
            
            <div class="summary-cards" id="summaryCards"></div>
            
            <div class="comparison-accounts-grid" id="comparisonAccountsGrid"></div>
            
            <div class="growth-indicator" id="overallGrowthIndicator"></div>
            
            <div class="button-group">
                <button class="btn save-btn" id="saveAllComparisonsBtn">
                    <i class="fas fa-save"></i> Save All
                </button>
                <button class="btn copy-btn" id="copyComparisonReportBtn">
                    <i class="fas fa-copy"></i> Copy Report
                </button>
                <button class="btn export-btn" id="downloadComparisonReportBtn">
                    <i class="fas fa-download"></i> Download
                </button>
            </div>
        </div>

        <!-- ENHANCED Savings Tracker Section -->
        <div class="savings-section">
            <div class="savings-header">
                <h2><i class="fas fa-piggy-bank"></i> My Savings</h2>
                <div class="total-savings" id="totalSavings">
                    <span class="rupee-symbol">₹</span>0.00
                </div>
            </div>
            
            <!-- Person Filter -->
            <div class="person-filter" id="personFilter">
                <div class="filter-title">
                    <i class="fas fa-filter"></i> Filter by Person:
                </div>
                <div class="filter-buttons" id="filterButtons">
                    <button class="filter-btn active" data-person="all">All Persons</button>
                </div>
            </div>
            
            <!-- Quick Copy Buttons -->
            <div class="quick-copy-buttons">
                <button class="btn copy-btn" id="copySummaryBtn">
                    <i class="fas fa-copy"></i> Copy Summary
                </button>
                <button class="btn copy-btn" id="copyAllBtn">
                    <i class="fas fa-copy"></i> Copy All
                </button>
            </div>
            
            <!-- Savings List - Enhanced with all details -->
            <div class="savings-list" id="savingsList">
                <div class="no-savings" id="noSavingsMessage">
                    <i class="fas fa-coins"></i>
                    <p>No savings added yet. Calculate an amount and click "Add to Savings"</p>
                </div>
            </div>
            
            <!-- Export Controls -->
            <div class="export-controls">
                <div class="button-group">
                    <button type="button" class="btn export-btn" id="exportSavingsBtn">
                        <i class="fas fa-camera"></i> Export/Snapshot
                    </button>
                    <button type="button" class="btn reset-btn" id="clearSavingsBtn">
                        <i class="fas fa-trash-alt"></i> Clear All
                    </button>
                </div>
            </div>
        </div>

        <!-- Info Section -->
        <div class="info-section">
            <div class="info-card">
                <i class="fas fa-calculator"></i>
                <h3>Four Calculation Modes</h3>
                <p>Find Maturity Amount • Interest Rate • Principal • Current Value</p>
            </div>
            <div class="info-card">
                <i class="fas fa-user"></i>
                <h3>Person-wise Tracking</h3>
                <p>Add account holder name to track investments by person. See summary cards and filter by person.</p>
            </div>
            <div class="info-card">
                <i class="fas fa-chart-bar"></i>
                <h3>Complete Details</h3>
                <p>Each savings item shows Principal, Interest Rate, Maturity Amount, and Current Value.</p>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="export-modal" id="exportModal">
        <div class="export-content">
            <div class="export-header">
                <h2><i class="fas fa-camera"></i> Export Data</h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="export-body">
                <div class="export-options">
                    <div class="export-option" id="copyTextOption">
                        <i class="fas fa-copy"></i>
                        <h4>Copy to Clipboard</h4>
                    </div>
                    <div class="export-option" id="downloadJSONOption">
                        <i class="fas fa-file-code"></i>
                        <h4>Download JSON</h4>
                    </div>
                    <div class="export-option" id="takeSnapshotOption">
                        <i class="fas fa-camera"></i>
                        <h4>Take Snapshot</h4>
                    </div>
                    <div class="export-option" id="exportCSVOption">
                        <i class="fas fa-file-csv"></i>
                        <h4>Export CSV</h4>
                    </div>
                </div>

                <div class="export-preview">
                    <h4>Preview</h4>
                    <pre id="exportPreview">Select an option to preview...</pre>
                </div>

                <button class="btn export-btn" id="executeExport" style="width: 100%; margin-bottom: 20px;">
                    <i class="fas fa-download"></i> Execute
                </button>

                <h4>Snapshot History</h4>
                <div class="snapshot-list" id="snapshotList">
                    <div class="no-savings">No snapshots</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="custom-notification" id="notification"></div>

    <footer>
        <p>Advanced Compound Interest Calculator • Person-wise Tracking • Complete Investment Details</p>
        <div class="tech-stack">
            <span class="tech-item">HTML5</span>
            <span class="tech-item">CSS3</span>
            <span class="tech-item">JavaScript</span>
            <span class="tech-item">Person Tracking</span>
        </div>
    </footer>

    <script>
        // DOM Elements
        const modeButtons = document.querySelectorAll('.mode-btn');
        const modeContents = document.querySelectorAll('.mode-content');
        const modeDescription = document.getElementById('modeDescription');
        const modeIndicator = document.getElementById('modeIndicator');
        
        // Input fields
        const principalAmount = document.getElementById('principal_amount');
        const interestRate = document.getElementById('interest_rate');
        const rateSlider = document.getElementById('rateSlider');
        const rateValue = document.getElementById('rateValue');
        
        const principalInterest = document.getElementById('principal_interest');
        const maturityInterest = document.getElementById('maturity_amount_interest');
        
        const maturityPrincipal = document.getElementById('maturity_amount_principal');
        const ratePrincipal = document.getElementById('interest_rate_principal');
        const rateSliderPrincipal = document.getElementById('rateSliderPrincipal');
        const rateValuePrincipal = document.getElementById('rateValuePrincipal');
        
        const principalCurrent = document.getElementById('principal_current');
        const maturityCurrent = document.getElementById('maturity_amount_current');
        
        // Person & Account fields
        const personName = document.getElementById('person_name');
        const accountNumber = document.getElementById('account_number');
        const accountType = document.getElementById('account_type');
        const bankName = document.getElementById('bank_name');
        
        // Common fields
        const startDate = document.getElementById('start_date');
        const maturityDate = document.getElementById('maturity_date');
        const compoundFreq = document.getElementById('compound_frequency');
        
        // Buttons
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const saveBtn = document.getElementById('saveAmountBtn');
        const exportBtn = document.getElementById('exportSavingsBtn');
        const clearAllBtn = document.getElementById('clearSavingsBtn');
        const copySummaryBtn = document.getElementById('copySummaryBtn');
        const copyAllBtn = document.getElementById('copyAllBtn');
        
        // Results elements
        const placeholderMsg = document.getElementById('placeholderMessage');
        const resultsContent = document.getElementById('resultsContent');
        const finalAmount = document.getElementById('finalAmount');
        const resultTitle = document.getElementById('resultTitle');
        const resultIcon = document.getElementById('resultIcon');
        const principalResult = document.getElementById('principalResult');
        const interestEarned = document.getElementById('interestEarned');
        const interestRateResult = document.getElementById('interestRateResult');
        const investmentPeriod = document.getElementById('investmentPeriod');
        const compoundingResult = document.getElementById('compoundingResult');
        const datesRange = document.getElementById('datesRange');
        const calcSummary = document.getElementById('calculationSummary');
        
        // Person & Account display
        const personCard = document.getElementById('personCard');
        const personNameDisplay = document.getElementById('personNameDisplay');
        const accountCard = document.getElementById('accountCard');
        const accountInfoDisplay = document.getElementById('accountInfoDisplay');
        
        // Progress
        const progressSection = document.getElementById('progressSection');
        const progressPercentage = document.getElementById('progressPercentage');
        const progressFill = document.getElementById('progressFill');
        
        // Person summary
        const personSummarySection = document.getElementById('personSummarySection');
        const personSummaryGrid = document.getElementById('personSummaryGrid');
        
        // Savings
        const totalSavings = document.getElementById('totalSavings');
        const savingsList = document.getElementById('savingsList');
        const noSavingsMessage = document.getElementById('noSavingsMessage');
        const filterButtons = document.getElementById('filterButtons');
        
        // Upload
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadedFileInfo = document.getElementById('uploadedFileInfo');
        const uploadedFileName = document.getElementById('uploadedFileName');
        const uploadedFileMeta = document.getElementById('uploadedFileMeta');
        const removeFileBtn = document.getElementById('removeFileBtn');
        const recalculateBtn = document.getElementById('recalculateFromUploadBtn');
        
        // Comparison
        const comparisonSection = document.getElementById('comparisonSection');
        const summaryCards = document.getElementById('summaryCards');
        const comparisonAccountsGrid = document.getElementById('comparisonAccountsGrid');
        const overallGrowthIndicator = document.getElementById('overallGrowthIndicator');
        const saveAllComparisonsBtn = document.getElementById('saveAllComparisonsBtn');
        const copyComparisonBtn = document.getElementById('copyComparisonReportBtn');
        const downloadComparisonBtn = document.getElementById('downloadComparisonReportBtn');
        
        // Modal
        const exportModal = document.getElementById('exportModal');
        const closeModal = document.getElementById('closeModal');
        const copyOption = document.getElementById('copyTextOption');
        const jsonOption = document.getElementById('downloadJSONOption');
        const snapshotOption = document.getElementById('takeSnapshotOption');
        const csvOption = document.getElementById('exportCSVOption');
        const exportPreview = document.getElementById('exportPreview');
        const executeExport = document.getElementById('executeExport');
        const snapshotList = document.getElementById('snapshotList');
        
        // Notification
        const notification = document.getElementById('notification');
        
        // Data storage
        let savings = JSON.parse(localStorage.getItem('savings')) || [];
        let snapshots = JSON.parse(localStorage.getItem('snapshots')) || [];
        let currentCalc = null;
        let currentMode = 'amount';
        let currentExportType = 'copy';
        let uploadedSnapshot = null;
        let comparisonData = [];
        let currentPersonFilter = 'all';
        
        // Account type names
        const accountTypeNames = {
            'savings': 'Savings',
            'current': 'Current',
            'fixed_deposit': 'FD',
            'recurring_deposit': 'RD',
            'ppf': 'PPF',
            'nps': 'NPS',
            'mutual_fund': 'MF',
            'stocks': 'Stocks',
            'bonds': 'Bonds',
            'other': 'Other'
        };
        
        // Initialize dates
        const today = new Date();
        const nextYear = new Date();
        nextYear.setFullYear(today.getFullYear() + 1);
        
        startDate.value = formatDate(today);
        maturityDate.value = formatDate(nextYear);
        
        // Initialize
        updateSavingsDisplay();
        updatePersonSummary();
        updateSnapshotsDisplay();
        
        // Mode switching
        modeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                modeButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                currentMode = btn.dataset.mode;
                
                modeContents.forEach(c => c.classList.add('hidden'));
                document.getElementById(`mode${currentMode.charAt(0).toUpperCase() + currentMode.slice(1)}`).classList.remove('hidden');
                
                const desc = {
                    amount: 'Calculate the final maturity amount based on principal, interest rate, and time period.',
                    interest: 'Calculate the required annual interest rate to reach a target maturity amount.',
                    principal: 'Calculate the initial principal amount needed to reach a target maturity amount.',
                    current: 'Calculate the current value of your investment based on progress to today.'
                };
                modeDescription.textContent = desc[currentMode];
                
                const titles = {
                    amount: 'Maturity Amount',
                    interest: 'Required Interest Rate',
                    principal: 'Principal Required',
                    current: 'Current Value'
                };
                resultTitle.textContent = titles[currentMode];
                
                const icons = {
                    amount: 'fa-money-check-alt',
                    interest: 'fa-percentage',
                    principal: 'fa-money-bill-wave',
                    current: 'fa-chart-line'
                };
                resultIcon.className = `fas ${icons[currentMode]}`;
                
                if (currentMode === 'current') {
                    progressSection.style.display = 'block';
                } else {
                    progressSection.style.display = 'none';
                }
                
                clearResults();
            });
        });
        
        // Sliders
        interestRate.addEventListener('input', () => {
            rateSlider.value = interestRate.value;
            rateValue.textContent = `${interestRate.value}%`;
        });
        
        rateSlider.addEventListener('input', () => {
            interestRate.value = rateSlider.value;
            rateValue.textContent = `${rateSlider.value}%`;
        });
        
        ratePrincipal.addEventListener('input', () => {
            rateSliderPrincipal.value = ratePrincipal.value;
            rateValuePrincipal.textContent = `${ratePrincipal.value}%`;
        });
        
        rateSliderPrincipal.addEventListener('input', () => {
            ratePrincipal.value = rateSliderPrincipal.value;
            rateValuePrincipal.textContent = `${ratePrincipal.value}%`;
        });
        
        // Calculate
        calculateBtn.addEventListener('click', calculate);
        
        function calculate() {
            try {
                const start = new Date(startDate.value);
                const end = new Date(maturityDate.value);
                const freq = parseInt(compoundFreq.value);
                
                if (start >= end) throw new Error('Maturity must be after start');
                
                const days = (end - start) / (1000 * 3600 * 24);
                const years = days / 365;
                
                let result;
                
                if (currentMode === 'amount') {
                    const p = parseFloat(principalAmount.value);
                    const r = parseFloat(interestRate.value) / 100;
                    if (isNaN(p) || p <= 0) throw new Error('Valid principal required');
                    if (isNaN(r) || r < 0) throw new Error('Valid rate required');
                    
                    const a = p * Math.pow(1 + r / freq, freq * years);
                    result = {
                        principal: p,
                        rate: r * 100,
                        amount: a,
                        interest: a - p,
                        mode: 'amount'
                    };
                }
                else if (currentMode === 'interest') {
                    const p = parseFloat(principalInterest.value);
                    const a = parseFloat(maturityInterest.value);
                    if (isNaN(p) || p <= 0) throw new Error('Valid principal required');
                    if (isNaN(a) || a <= 0) throw new Error('Valid target required');
                    if (a <= p) throw new Error('Target must be greater than principal');
                    
                    const r = freq * (Math.pow(a / p, 1 / (freq * years)) - 1);
                    result = {
                        principal: p,
                        rate: r * 100,
                        amount: a,
                        interest: a - p,
                        mode: 'interest'
                    };
                }
                else if (currentMode === 'principal') {
                    const a = parseFloat(maturityPrincipal.value);
                    const r = parseFloat(ratePrincipal.value) / 100;
                    if (isNaN(a) || a <= 0) throw new Error('Valid target required');
                    if (isNaN(r) || r < 0) throw new Error('Valid rate required');
                    
                    const p = a / Math.pow(1 + r / freq, freq * years);
                    result = {
                        principal: p,
                        rate: r * 100,
                        amount: a,
                        interest: a - p,
                        mode: 'principal'
                    };
                }
                else if (currentMode === 'current') {
                    const p = parseFloat(principalCurrent.value);
                    const a = parseFloat(maturityCurrent.value);
                    if (isNaN(p) || p <= 0) throw new Error('Valid principal required');
                    if (isNaN(a) || a <= 0) throw new Error('Valid maturity required');
                    if (a <= p) throw new Error('Maturity must be greater than principal');
                    
                    const r = freq * (Math.pow(a / p, 1 / (freq * years)) - 1);
                    const elapsed = Math.max(0, (new Date() - start) / (1000 * 3600 * 24));
                    
                    let current;
                    if (elapsed >= days) {
                        current = a;
                    } else {
                        const elapsedYears = elapsed / 365;
                        current = p * Math.pow(1 + r / freq, freq * elapsedYears);
                    }
                    
                    result = {
                        principal: p,
                        rate: r * 100,
                        amount: a,
                        current: current,
                        interest: current - p,
                        progress: (elapsed / days * 100).toFixed(1),
                        mode: 'current'
                    };
                }
                
                // Add common data
                result.startDate = startDate.value;
                result.maturityDate = maturityDate.value;
                result.years = years.toFixed(2);
                result.freq = getFreqName(freq);
                
                // Add person & account
                if (personName.value.trim()) {
                    result.person = personName.value.trim();
                }
                if (accountNumber.value.trim() || accountType.value) {
                    result.account = {
                        number: accountNumber.value.trim(),
                        type: accountType.value,
                        typeName: accountTypeNames[accountType.value] || accountType.value,
                        bank: bankName.value.trim()
                    };
                }
                
                currentCalc = result;
                displayResults(result);
                
            } catch (e) {
                showNotification(e.message, 'error');
            }
        }
        
        function displayResults(r) {
            placeholderMsg.style.display = 'none';
            resultsContent.style.display = 'block';
            
            // Main amount
            let mainAmount = r.mode === 'current' ? r.current : r.amount;
            finalAmount.innerHTML = `₹${formatNumber(mainAmount)}`;
            
            // Details
            principalResult.innerHTML = `₹${formatNumber(r.principal)}`;
            interestEarned.innerHTML = `₹${formatNumber(r.interest)}`;
            interestRateResult.innerHTML = `${r.rate.toFixed(2)}%`;
            investmentPeriod.innerHTML = `${r.years} years`;
            compoundingResult.innerHTML = r.freq;
            datesRange.innerHTML = `${formatDisplayDate(r.startDate)} to ${formatDisplayDate(r.maturityDate)}`;
            
            // Person info
            if (r.person) {
                personCard.style.display = 'flex';
                personNameDisplay.innerHTML = r.person;
            } else {
                personCard.style.display = 'none';
            }
            
            // Account info
            if (r.account) {
                accountCard.style.display = 'flex';
                let html = '';
                if (r.account.number) {
                    html += `<div class="account-field"><span class="account-label"><i class="fas fa-credit-card"></i> Number</span><span class="account-value">${r.account.number}</span></div>`;
                }
                if (r.account.typeName) {
                    html += `<div class="account-field"><span class="account-label"><i class="fas fa-tag"></i> Type</span><span class="account-value">${r.account.typeName}</span></div>`;
                }
                if (r.account.bank) {
                    html += `<div class="account-field"><span class="account-label"><i class="fas fa-building"></i> Bank</span><span class="account-value">${r.account.bank}</span></div>`;
                }
                accountInfoDisplay.innerHTML = html;
            } else {
                accountCard.style.display = 'none';
            }
            
            // Progress
            if (r.mode === 'current') {
                progressSection.style.display = 'block';
                progressPercentage.textContent = `${r.progress}%`;
                progressFill.style.width = `${r.progress}%`;
            }
            
            // Summary
            if (r.mode === 'amount') {
                calcSummary.innerHTML = `₹${formatNumber(r.principal)} at ${r.rate.toFixed(2)}% for ${r.years} years will grow to ₹${formatNumber(r.amount)}`;
            } else if (r.mode === 'interest') {
                calcSummary.innerHTML = `Need ${r.rate.toFixed(2)}% interest to reach ₹${formatNumber(r.amount)} from ₹${formatNumber(r.principal)}`;
            } else if (r.mode === 'principal') {
                calcSummary.innerHTML = `Need to invest ₹${formatNumber(r.principal)} today to reach ₹${formatNumber(r.amount)}`;
            } else if (r.mode === 'current') {
                calcSummary.innerHTML = `Current value: ₹${formatNumber(r.current)} (${r.progress}% complete)`;
            }
        }
        
        function clearResults() {
            placeholderMsg.style.display = 'flex';
            resultsContent.style.display = 'none';
            personCard.style.display = 'none';
            accountCard.style.display = 'none';
            currentCalc = null;
        }
        
        // Save to savings
        saveBtn.addEventListener('click', () => {
            if (!currentCalc) {
                showNotification('Calculate first', 'warning');
                return;
            }
            
            const amount = currentCalc.mode === 'current' ? currentCalc.current : currentCalc.amount;
            
            const item = {
                id: Date.now(),
                amount: amount,
                desc: `${resultTitle.textContent}: ${formatDisplayDate(currentCalc.startDate)} to ${formatDisplayDate(currentCalc.maturityDate)}`,
                date: new Date().toLocaleDateString('en-IN'),
                calc: {
                    principal: currentCalc.principal,
                    rate: currentCalc.rate,
                    amount: currentCalc.amount,
                    current: currentCalc.current || amount
                },
                person: currentCalc.person || null,
                account: currentCalc.account || null
            };
            
            savings.push(item);
            localStorage.setItem('savings', JSON.stringify(savings));
            
            updateSavingsDisplay();
            updatePersonSummary();
            showNotification(`Added ₹${formatNumber(amount)} to savings`, 'success');
        });
        
        // Enhanced savings display with all details
        function updateSavingsDisplay() {
            const total = savings.reduce((s, i) => s + i.amount, 0);
            totalSavings.innerHTML = `₹${formatNumber(total)}`;
            
            // Update person filter
            updatePersonFilter();
            
            // Filter by person
            let filtered = savings;
            if (currentPersonFilter !== 'all') {
                filtered = savings.filter(s => s.person === currentPersonFilter);
            }
            
            if (!filtered.length) {
                savingsList.innerHTML = '<div class="no-savings"><i class="fas fa-coins"></i><p>No savings to display</p></div>';
                return;
            }
            
            savingsList.innerHTML = '';
            
            filtered.forEach(item => {
                const el = document.createElement('div');
                el.className = 'savings-item';
                
                // Person badge
                const personBadge = item.person ? 
                    `<div class="person-badge"><i class="fas fa-user"></i> ${item.person}</div>` : 
                    '<div class="person-badge" style="background: #95a5a6;"><i class="fas fa-user"></i> Unnamed</div>';
                
                // Account badges
                let accountHtml = '';
                if (item.account) {
                    if (item.account.number) {
                        accountHtml += `<span class="account-badge"><i class="fas fa-credit-card"></i> ${item.account.number}</span>`;
                    }
                    if (item.account.typeName) {
                        accountHtml += `<span class="account-badge"><i class="fas fa-tag"></i> ${item.account.typeName}</span>`;
                    }
                }
                
                // Enhanced details grid showing all required fields
                el.innerHTML = `
                    <div class="savings-header-info">
                        <div class="savings-title">
                            <i class="fas fa-coins"></i>
                            <span>${item.desc}</span>
                        </div>
                        ${personBadge}
                    </div>
                    
                    <div class="details-grid">
                        <div class="detail-box">
                            <div class="label">Principal</div>
                            <div class="value principal-value">₹${formatNumber(item.calc.principal)}</div>
                        </div>
                        <div class="detail-box">
                            <div class="label">Interest Rate</div>
                            <div class="value rate-value">${item.calc.rate.toFixed(2)}%</div>
                        </div>
                        <div class="detail-box">
                            <div class="label">Maturity</div>
                            <div class="value maturity-value">₹${formatNumber(item.calc.amount)}</div>
                        </div>
                        <div class="detail-box">
                            <div class="label">Current Value</div>
                            <div class="value current-value">₹${formatNumber(item.amount)}</div>
                        </div>
                    </div>
                    
                    ${accountHtml ? `<div class="account-badges">${accountHtml}</div>` : ''}
                    
                    <div class="savings-footer">
                        <span><i class="far fa-calendar-alt"></i> Added: ${item.date}</span>
                        <span><i class="fas fa-chart-line"></i> ${((item.amount / item.calc.amount) * 100).toFixed(1)}% of target</span>
                    </div>
                    
                    <button class="copy-btn-small" onclick="copyItem(${item.id})">
                        <i class="fas fa-copy"></i>
                    </button>
                `;
                
                savingsList.appendChild(el);
            });
        }
        
        // Person filter
        function updatePersonFilter() {
            const persons = new Set(savings.map(s => s.person).filter(p => p));
            
            let html = '<button class="filter-btn active" data-person="all">All Persons</button>';
            persons.forEach(p => {
                html += `<button class="filter-btn" data-person="${p}">${p}</button>`;
            });
            
            filterButtons.innerHTML = html;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentPersonFilter = btn.dataset.person;
                    updateSavingsDisplay();
                });
            });
        }
        
        // Person summary
        function updatePersonSummary() {
            const personMap = new Map();
            
            savings.forEach(item => {
                if (!item.person) return;
                
                if (!personMap.has(item.person)) {
                    personMap.set(item.person, {
                        principal: 0,
                        current: 0,
                        count: 0,
                        accounts: new Set()
                    });
                }
                
                const data = personMap.get(item.person);
                data.principal += item.calc.principal;
                data.current += item.amount;
                data.count++;
                if (item.account?.number) {
                    data.accounts.add(item.account.number);
                }
            });
            
            if (personMap.size === 0) {
                personSummaryGrid.innerHTML = '<div class="no-savings"><i class="fas fa-user-plus"></i><p>Add account holder names to see person-wise summary</p></div>';
                return;
            }
            
            personSummaryGrid.innerHTML = '';
            
            for (const [name, data] of personMap) {
                const card = document.createElement('div');
                card.className = 'person-card';
                card.innerHTML = `
                    <h3><i class="fas fa-user-circle"></i> ${name}</h3>
                    <div class="person-stats"><span class="label">Accounts:</span><span class="value">${data.accounts.size}</span></div>
                    <div class="person-stats"><span class="label">Investments:</span><span class="value">${data.count}</span></div>
                    <div class="person-stats"><span class="label">Total Principal:</span><span class="value">₹${formatNumber(data.principal)}</span></div>
                    <div class="person-total">Current: ₹${formatNumber(data.current)}</div>
                `;
                personSummaryGrid.appendChild(card);
            }
        }
        
        // Copy functions
        window.copyItem = (id) => {
            const item = savings.find(s => s.id === id);
            if (!item) return;
            
            let text = `INVESTMENT DETAILS\n`;
            if (item.person) text += `Person: ${item.person}\n`;
            text += `Principal: ₹${formatNumber(item.calc.principal)}\n`;
            text += `Rate: ${item.calc.rate.toFixed(2)}%\n`;
            text += `Maturity: ₹${formatNumber(item.calc.amount)}\n`;
            text += `Current: ₹${formatNumber(item.amount)}\n`;
            if (item.account?.number) text += `Account: ${item.account.number}`;
            
            copyToClipboard(text, 'Item copied!');
        };
        
        copySummaryBtn.addEventListener('click', () => {
            const total = savings.reduce((s,i) => s + i.amount, 0);
            let text = `SAVINGS SUMMARY\n`;
            text += `Total: ₹${formatNumber(total)}\n`;
            text += `Items: ${savings.length}\n`;
            text += `Persons: ${new Set(savings.map(s => s.person).filter(p => p)).size}\n\n`;
            
            savings.slice(-5).reverse().forEach((item, i) => {
                text += `${i+1}. ${item.desc.substring(0,30)}... ₹${formatNumber(item.amount)}\n`;
            });
            
            copyToClipboard(text, 'Summary copied!');
        });
        
        copyAllBtn.addEventListener('click', () => {
            let text = `COMPLETE SAVINGS REPORT\n${'='.repeat(50)}\n\n`;
            
            const byPerson = {};
            savings.forEach(item => {
                const p = item.person || 'Unnamed';
                if (!byPerson[p]) byPerson[p] = [];
                byPerson[p].push(item);
            });
            
            for (const [p, items] of Object.entries(byPerson)) {
                text += `\n👤 ${p}\n${'-'.repeat(30)}\n`;
                items.forEach((item, i) => {
                    text += `${i+1}. ${item.desc}\n`;
                    text += `   Principal: ₹${formatNumber(item.calc.principal)}\n`;
                    text += `   Rate: ${item.calc.rate.toFixed(2)}%\n`;
                    text += `   Maturity: ₹${formatNumber(item.calc.amount)}\n`;
                    text += `   Current: ₹${formatNumber(item.amount)}\n`;
                    if (item.account?.number) text += `   A/C: ${item.account.number}\n\n`;
                });
            }
            
            copyToClipboard(text, 'All data copied!');
        });
        
        function copyToClipboard(text, msg) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification(msg, 'success');
            }).catch(() => {
                const ta = document.createElement('textarea');
                ta.value = text;
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                ta.remove();
                showNotification(msg, 'success');
            });
        }
        
        // Export modal
        exportBtn.addEventListener('click', () => {
            exportModal.classList.add('show');
            setExportType('copy');
        });
        
        closeModal.addEventListener('click', () => {
            exportModal.classList.remove('show');
        });
        
        exportModal.addEventListener('click', (e) => {
            if (e.target === exportModal) {
                exportModal.classList.remove('show');
            }
        });
        
        copyOption.addEventListener('click', () => setExportType('copy'));
        jsonOption.addEventListener('click', () => setExportType('json'));
        snapshotOption.addEventListener('click', () => setExportType('snapshot'));
        csvOption.addEventListener('click', () => setExportType('csv'));
        
        function setExportType(type) {
            currentExportType = type;
            document.querySelectorAll('.export-option').forEach(opt => opt.style.borderColor = 'transparent');
            
            if (type === 'copy') {
                copyOption.style.borderColor = '#ff9e00';
                exportPreview.textContent = generateTextExport();
            } else if (type === 'json') {
                jsonOption.style.borderColor = '#ff9e00';
                exportPreview.textContent = JSON.stringify(generateExportData(), null, 2);
            } else if (type === 'snapshot') {
                snapshotOption.style.borderColor = '#ff9e00';
                const total = savings.reduce((s,i) => s + i.amount, 0);
                exportPreview.textContent = `Snapshot will save:\n• Total: ₹${formatNumber(total)}\n• Items: ${savings.length}\n• Persons: ${new Set(savings.map(s => s.person).filter(p => p)).size}`;
            } else if (type === 'csv') {
                csvOption.style.borderColor = '#ff9e00';
                let csv = 'Person,Description,Principal,Rate%,Maturity,Current,Account\n';
                savings.forEach(item => {
                    const p = item.person || 'Unnamed';
                    const desc = `"${item.desc.replace(/"/g, '""')}"`;
                    csv += `"${p}",${desc},${item.calc.principal},${item.calc.rate},${item.calc.amount},${item.amount},"${item.account?.number || ''}"\n`;
                });
                exportPreview.textContent = csv;
            }
        }
        
        function generateExportData() {
            return {
                date: new Date().toISOString(),
                total: savings.reduce((s,i) => s + i.amount, 0),
                count: savings.length,
                savings: savings
            };
        }
        
        function generateTextExport() {
            const total = savings.reduce((s,i) => s + i.amount, 0);
            let text = `SAVINGS REPORT - ${new Date().toLocaleString()}\n${'='.repeat(50)}\n`;
            text += `Total: ₹${formatNumber(total)}\nItems: ${savings.length}\n\n`;
            
            const byPerson = {};
            savings.forEach(item => {
                const p = item.person || 'Unnamed';
                if (!byPerson[p]) byPerson[p] = [];
                byPerson[p].push(item);
            });
            
            for (const [p, items] of Object.entries(byPerson)) {
                text += `\n👤 ${p}\n${'-'.repeat(30)}\n`;
                items.forEach((item, i) => {
                    text += `${i+1}. ${item.desc}\n`;
                    text += `   Principal: ₹${formatNumber(item.calc.principal)}\n`;
                    text += `   Rate: ${item.calc.rate.toFixed(2)}%\n`;
                    text += `   Maturity: ₹${formatNumber(item.calc.amount)}\n`;
                    text += `   Current: ₹${formatNumber(item.amount)}\n`;
                    if (item.account?.number) text += `   A/C: ${item.account.number}\n\n`;
                });
            }
            return text;
        }
        
        executeExport.addEventListener('click', () => {
            if (currentExportType === 'copy') {
                copyToClipboard(generateTextExport(), 'Data copied!');
            } else if (currentExportType === 'json') {
                const data = generateExportData();
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `savings_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                showNotification('JSON downloaded', 'success');
            } else if (currentExportType === 'snapshot') {
                const snapshot = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    data: generateExportData(),
                    summary: {
                        total: savings.reduce((s,i) => s + i.amount, 0),
                        count: savings.length
                    }
                };
                snapshots.unshift(snapshot);
                if (snapshots.length > 10) snapshots = snapshots.slice(0, 10);
                localStorage.setItem('snapshots', JSON.stringify(snapshots));
                updateSnapshotsDisplay();
                showNotification('Snapshot saved', 'success');
            } else if (currentExportType === 'csv') {
                let csv = 'Person,Description,Principal,Rate%,Maturity,Current,Account\n';
                savings.forEach(item => {
                    const p = item.person || 'Unnamed';
                    const desc = `"${item.desc.replace(/"/g, '""')}"`;
                    csv += `"${p}",${desc},${item.calc.principal},${item.calc.rate},${item.calc.amount},${item.amount},"${item.account?.number || ''}"\n`;
                });
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `savings_${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                URL.revokeObjectURL(url);
                showNotification('CSV downloaded', 'success');
            }
            
            if (currentExportType !== 'snapshot') {
                exportModal.classList.remove('show');
            }
        });
        
        function updateSnapshotsDisplay() {
            if (!snapshots.length) {
                snapshotList.innerHTML = '<div class="no-savings">No snapshots</div>';
                return;
            }
            
            snapshotList.innerHTML = snapshots.map((s, i) => `
                <div style="background: #f8f9fa; padding: 10px; margin-bottom: 5px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>Snapshot ${i+1}</strong><br>
                        <small>${new Date(s.date).toLocaleString()}</small><br>
                        <small>₹${formatNumber(s.summary.total)} • ${s.summary.count} items</small>
                    </div>
                    <button onclick="restoreSnapshot(${s.id})" style="background: none; border: none; color: var(--primary-color); cursor: pointer;">
                        <i class="fas fa-history"></i>
                    </button>
                </div>
            `).join('');
        }
        
        window.restoreSnapshot = (id) => {
            const s = snapshots.find(s => s.id === id);
            if (!s) return;
            savings = s.data.savings || [];
            localStorage.setItem('savings', JSON.stringify(savings));
            updateSavingsDisplay();
            updatePersonSummary();
            showNotification('Snapshot restored', 'success');
            exportModal.classList.remove('show');
        };
        
        // Clear all
        clearAllBtn.addEventListener('click', () => {
            if (!savings.length) {
                showNotification('No savings to clear', 'warning');
                return;
            }
            if (confirm('Clear all savings?')) {
                savings = [];
                localStorage.setItem('savings', JSON.stringify(savings));
                updateSavingsDisplay();
                updatePersonSummary();
                showNotification('All cleared', 'success');
            }
        });
        
        // Reset form
        resetBtn.addEventListener('click', () => {
            document.getElementById('interestForm').reset();
            personName.value = '';
            accountNumber.value = '';
            accountType.value = '';
            bankName.value = '';
            
            rateSlider.value = 7.5;
            rateValue.textContent = '7.5%';
            rateSliderPrincipal.value = 7.5;
            rateValuePrincipal.textContent = '7.5%';
            
            const t = new Date();
            const n = new Date();
            n.setFullYear(t.getFullYear() + 1);
            startDate.value = formatDate(t);
            maturityDate.value = formatDate(n);
            
            clearResults();
            showNotification('Form reset', 'success');
        });
        
        // Upload functions
        uploadArea.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.background = 'rgba(0, 180, 216, 0.2)';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.background = 'rgba(0, 180, 216, 0.05)';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.background = 'rgba(0, 180, 216, 0.05)';
            if (e.dataTransfer.files.length) {
                handleFileUpload(e.dataTransfer.files[0]);
            }
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleFileUpload(e.target.files[0]);
            }
        });
        
        removeFileBtn.addEventListener('click', () => {
            uploadedSnapshot = null;
            uploadedFileInfo.style.display = 'none';
            fileInput.value = '';
            recalculateBtn.disabled = true;
            comparisonSection.style.display = 'none';
        });
        
        function handleFileUpload(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    uploadedSnapshot = data;
                    uploadedFileName.textContent = file.name;
                    const size = (file.size / 1024).toFixed(2);
                    uploadedFileMeta.textContent = `${size} KB`;
                    uploadedFileInfo.style.display = 'flex';
                    recalculateBtn.disabled = false;
                    showNotification('File uploaded', 'success');
                } catch {
                    showNotification('Invalid JSON file', 'error');
                }
            };
            reader.readAsText(file);
        }
        
        recalculateBtn.addEventListener('click', () => {
            if (!uploadedSnapshot?.savings) return;
            
            comparisonData = [];
            let totalOriginal = 0, totalCurrent = 0;
            
            uploadedSnapshot.savings.forEach((item, i) => {
                const calc = item.calc || item.calculationDetails;
                if (!calc) return;
                
                const current = item.amount || calc.current || calc.amount;
                comparisonData.push({
                    id: i,
                    name: item.person || 'Unknown',
                    account: item.account?.number || `A/C ${i+1}`,
                    type: item.account?.typeName || 'Account',
                    original: calc.amount,
                    current: current,
                    principal: calc.principal,
                    rate: calc.rate,
                    growth: current - calc.amount,
                    growthPercent: ((current - calc.amount) / calc.amount * 100).toFixed(2)
                });
                
                totalOriginal += calc.amount;
                totalCurrent += current;
            });
            
            displayComparison(totalOriginal, totalCurrent);
        });
        
        function displayComparison(totalOriginal, totalCurrent) {
            comparisonSection.style.display = 'block';
            const growth = totalCurrent - totalOriginal;
            const growthPercent = ((growth / totalOriginal) * 100).toFixed(2);
            
            summaryCards.innerHTML = `
                <div class="summary-card"><h4>Total Original</h4><div class="value">₹${formatNumber(totalOriginal)}</div></div>
                <div class="summary-card"><h4>Total Current</h4><div class="value">₹${formatNumber(totalCurrent)}</div></div>
                <div class="summary-card"><h4>Growth</h4><div class="value">${growth>=0?'+':''}${formatNumber(growth)}</div><div class="sub-value">${growthPercent}%</div></div>
                <div class="summary-card"><h4>Accounts</h4><div class="value">${comparisonData.length}</div></div>
            `;
            
            comparisonAccountsGrid.innerHTML = comparisonData.map(a => `
                <div class="comparison-account-card">
                    <div><strong>${a.name}</strong> • ${a.account}</div>
                    <div>Original: ₹${formatNumber(a.original)} | Current: ₹${formatNumber(a.current)}</div>
                    <div class="${a.growth>=0?'positive':'negative'}">${a.growth>=0?'+':''}${a.growthPercent}%</div>
                </div>
            `).join('');
            
            overallGrowthIndicator.className = `growth-indicator ${growth>=0?'positive':'negative'}`;
            overallGrowthIndicator.innerHTML = `${growth>=0?'📈':'📉'} Overall ${growth>=0?'Growth':'Decline'}: ${growth>=0?'+':''}${formatNumber(growth)} (${growthPercent}%)`;
        }
        
        saveAllComparisonsBtn.addEventListener('click', () => {
            comparisonData.forEach(a => {
                savings.push({
                    id: Date.now() + Math.random(),
                    amount: a.current,
                    desc: `Compared: ${a.name}`,
                    date: new Date().toLocaleDateString(),
                    calc: { principal: a.principal, rate: a.rate, amount: a.original },
                    person: a.name,
                    account: { number: a.account, typeName: a.type }
                });
            });
            localStorage.setItem('savings', JSON.stringify(savings));
            updateSavingsDisplay();
            updatePersonSummary();
            showNotification('Saved all', 'success');
        });
        
        copyComparisonBtn.addEventListener('click', () => {
            let text = `COMPARISON REPORT\n`;
            comparisonData.forEach(a => {
                text += `${a.name}: ₹${formatNumber(a.original)} → ₹${formatNumber(a.current)} (${a.growthPercent}%)\n`;
            });
            copyToClipboard(text, 'Report copied');
        });
        
        downloadComparisonBtn.addEventListener('click', () => {
            const blob = new Blob([JSON.stringify(comparisonData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `comparison_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        });
        
        // Utility functions
        function formatDate(d) {
            return d.toISOString().split('T')[0];
        }
        
        function formatDisplayDate(d) {
            return new Date(d).toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' });
        }
        
        function formatNumber(n) {
            if (n >= 1e7) return (n / 1e7).toFixed(2) + ' Cr';
            if (n >= 1e5) return (n / 1e5).toFixed(2) + ' L';
            return n.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
        
        function getFreqName(f) {
            const names = {365:'Daily',52:'Weekly',12:'Monthly',4:'Quarterly',2:'Half-Yearly',1:'Yearly'};
            return names[f] || 'Custom';
        }
        
        function showNotification(msg, type) {
            notification.className = `custom-notification ${type} show`;
            notification.innerHTML = `<i class="fas ${type==='success'?'fa-check-circle':'fa-exclamation-circle'}"></i><span>${msg}</span>`;
            setTimeout(() => notification.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>